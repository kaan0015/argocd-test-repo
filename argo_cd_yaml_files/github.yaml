apiVersion: argoproj.io/v1alpha1
kind: Sensor
metadata:
  name: mr-undeploy
spec:
  dependencies:
    - name: mr-close
      eventSourceName: github
      eventName: example
      filters:
        data:
          - path: argo_cd_yaml_files
            type: string
            value:
              - close
              - merge
  triggers:
    - template:
        conditions: "mr-close"
        name: mr-undeploy
        k8s:
        operation: delete 
        source:
          resource:
            apiVersion: argoproj.io/v1alpha1
            kind: Workflow
            metadata:
              name: github-
        parameters:
        - src:
            dependencyName: mr-close
            dataTemplate: "{{ .Input.body.pull_request.number }}-{{ .Input.body.pull_request.head.sha | substr 0 7 }}"
          dest: metadata.name